<div [formGroup]="form" *ngIf="data$ | async as data">
  <ng-template #addFloorplanBtn>
    <button
      *ngIf="isEdit"
      type="button"
      class="btn btn-warning ml-3"
      (click)="openFloorplanEditor(data)"
    >
      Add floorplan
    </button>
  </ng-template>
  <nav
    class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap shadow"
  >
    <a class="navbar-brand" href="javascript: alert('Logo')">
      <img src="assets/img/logo.svg" alt="Lidarama" />
    </a>
    <button
      (click)="isCollapsed = !isCollapsed"
      class="navbar-toggler"
      type="button"
      aria-controls="navbarSupportedContent"
      [attr.aria-expanded]="isCollapsed"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div [ngbCollapse]="isCollapsed" class="collapse navbar-collapse">
      <!-- <ul class="navbar-nav mr-auto">
        <li class="nav-item" *ngIf="isEdit">
          <a [routerLink]="['/projects']" class="nav-link">Projects</a>
        </li>
        <li class="nav-item">
          <button
            class="btn btn-success mr-2"
            type="button"
            (click)="takeScreenshot()"
          >
            Take screenshot
          </button>
        </li>
        <li class="nav-item">
          <select
            class="custom-select"
            formControlName="aspectRatio"
            name="aspectRatio"
            (change)="updateCanvasSize()"
          >
            <option *ngFor="let aspect of aspects" [value]="aspect.value">
              {{ aspect.name }}
            </option>
          </select>
        </li>
        <li class="nav-item">
          <input
            *ngIf="form.value.aspectRatio === 'custom'"
            type="number"
            min="0"
            max="2"
            step="0.1"
            class="form-control"
            placeholder="Ratio"
            formControlName="customRatio"
          />
        </li>
      </ul> -->

      <div class="d-flex flex-wrap ml-auto">
        <!-- <div
          *ngIf="isEdit"
          ngbDropdown
          [autoClose]="false"
          placement="left"
          class="d-inline-block"
        >
          <button class="btn btn-primary" id="dropdownForm1" ngbDropdownToggle>
            Settings
          </button>

          <div
            ngbDropdownMenu
            style="min-width: 280px"
            aria-labelledby="dropdownForm1"
          >
            <form class="px-4 py-3">
              <h3>Defaults</h3>

              <div class="form-group">
                <label>Zoom</label>
                <div class="range-slider">
                  <input
                    class="range-slider__range"
                    (input)="zoomChange()"
                    type="range"
                    formControlName="zoom"
                    step="0"
                    min="30"
                    max="120"
                  />
                  <span class="range-slider__value">
                    <input
                      (change)="zoomChange()"
                      [value]="form.value.zoom"
                      type="number"
                      formControlName="zoom"
                      step="1"
                      min="30"
                      max="120"
                      placeholder="number"
                    />
                  </span>
                </div>
              </div>
              <div class="form-group">
                <label>Default rotation</label>
                <div class="range-slider">
                  <input
                    class="range-slider__range"
                    (input)="rotationYChange()"
                    type="range"
                    formControlName="rotationY"
                    step="0.1"
                    min="0"
                    max="6.3"
                  />
                  <span class="range-slider__value">
                    <input
                      type="number"
                      formControlName="rotationY"
                      (change)="rotationYChange()"
                      [value]="form.value.rotationY"
                      step="0.1"
                      min="0"
                      max="6.3"
                    />
                  </span>
                </div>
              </div>

              <button
                type="button"
                (click)="saveSettings(data.project_id)"
                class="btn btn-success"
              >
                Save defaults
              </button>

              <div class="dropdown-divider"></div>
              <h4>Panorama</h4>

              <div class="form-group">
                <label>Zoom</label>
                <div class="range-slider">
                  <input
                    class="range-slider__range"
                    (input)="panoZoomChange()"
                    type="range"
                    formControlName="panoZoom"
                    step="1"
                    min="30"
                    max="120"
                  />
                  <span class="range-slider__value">
                    <input
                      type="number"
                      formControlName="panoZoom"
                      (change)="panoZoomChange()"
                      [value]="form.value.panoZoom"
                      step="1"
                      min="30"
                      max="120"
                    />
                  </span>
                </div>
              </div>

              <div class="form-group">
                <label>Rotation</label>
                <div class="range-slider">
                  <input
                    class="range-slider__range"
                    (input)="panoCameraStartAngleChange()"
                    type="range"
                    formControlName="panoCameraStartAngle"
                    step="0.1"
                    min="0"
                    max="6.3"
                  />
                  <span class="range-slider__value">
                    <input
                      type="number"
                      formControlName="panoCameraStartAngle"
                      (change)="panoCameraStartAngleChange()"
                      [value]="form.value.panoCameraStartAngle"
                      step="0.1"
                      min="0"
                      max="6.3"
                    />
                  </span>
                </div>
              </div>

              <button
                type="button"
                class="btn btn-success"
                (click)="updatePanoSettings()"
              >
                Save panorama
              </button>
            </form>
          </div>
        </div> -->

        <ng-template #tipContent>
          <div
            class="btn-group btn-group-lg btn-group-toggle"
            ngbRadioGroup
            name="radioBasic"
            formControlName="sidebarSide"
          >
            <label
              ngbButtonLabel
              [class.btn-light]="form.value.sidebarSide !== 'l'"
              [class.btn-danger]="form.value.sidebarSide === 'l'"
            >
              <input ngbButton type="radio" value="l" />
              <img
                src="assets/img/icons/sidebar-{{
                  form.value.sidebarSide === 'l' ? 'left' : 'right'
                }}.svg"
                alt="sidebar-left"
              />
              Left
            </label>
            <label
              ngbButtonLabel
              [class.btn-light]="form.value.sidebarSide !== 'r'"
              [class.btn-danger]="form.value.sidebarSide === 'r'"
            >
              <input ngbButton type="radio" value="r" /> Right
              <img
                src="assets/img/icons/sidebar-{{
                  form.value.sidebarSide !== 'l' ? 'left' : 'right'
                }}.svg"
                alt="sidebar-left"
              />
            </label>
          </div>
        </ng-template>

        <div>
          <a class="btn btn-link" href="javascript:;">
            <img src="assets/img/icons/youtube.svg" alt="YouTube" />
          </a>

          <a class="btn btn-link" href="javascript:;">
            <img src="assets/img/icons/instagram.svg" alt="Instagram" />
          </a>

          <a class="btn btn-link" href="javascript:;">
            <img src="assets/img/icons/facebook.svg" alt="Facebook" />
          </a>
        </div>
        <ng-template #loginBtn>
          <button 
          type="button"
          class="btn btn-lg btn-dark rounded-pill btn-black text-uppercase border-1 border-white ml-3 px-5"
        >
          <span>Log in</span>
        </button>
        </ng-template>
        
        <ng-container *ngIf="isEdit; else loginBtn">
          <button type="button" class="btn btn-lg btn-dark rounded-pill btn-black text-uppercase border-1 border-white ml-3 px-5">
            <span>Log out</span>
          </button>
          <button type="button" class="btn btn-danger rounded-pill text-uppercase border-1 border-white ml-3 px-5">
            <span>Publish</span>
          </button>
        </ng-container>

        <!-- <button *ngIf="isEdit; else loginBtn"
            #tooltipView="ngbTooltip"
            type="button"
            class="btn btn-lg btn-dark rounded-pill btn-change-view btn-black ml-3"
            [ngbTooltip]="tipContent"
            tooltipClass="tooltop-p-0"
            triggers="click"
            [autoClose]="'outside'"
          >
            <span>Change view</span>
            <img
              src="assets/img/icons/angle.svg"
              class="angle"
              [class.angle-flip]="tooltipView.isOpen()"
              alt="angle"
            />
        </button> -->

        

        <!-- <ng-container *ngTemplateOutlet="addFloorplanBtn"></ng-container> -->
      </div>
    </div>
  </nav>

  <ng-template #modalWrapper let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">{{ modalTitle }}</h4>
      <button
        type="button"
        class="close"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body" *ngIf="modalContent">
      <ng-container *ngTemplateOutlet="modalContent"></ng-container>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-dark"
        (click)="modal.close('Save click')"
      >
        Close
      </button>
    </div>
  </ng-template>

  <ng-template #floorplanTpl>
    <div
      class="vt-map"
      *ngIf="
        data.additional_data && data.additional_data.floors;
        else addFloorplanBtn
      "
    >
      <ul
        ngbNav
        (navChange)="navFloor($event, data.panoFloors, data.panos)"
        #nav="ngbNav"
        [activeId]="activeFloor"
        class="nav-tabs mb-5"
      >
        <li
          *ngFor="let f of data.additional_data.floors; index as i"
          [ngbNavItem]="f.floor"
        >
          <a ngbNavLink>{{ f.floor }}</a>
          <ng-template ngbNavContent>
            <div class="d-flex justify-content-center">
              <div
                #bound
                class="vt-map-wrapper"
                [style.transform]="'rotate(' + -f.nav_dots_rotation + 'deg)'"
              >
                <img
                  class="vt-map-wrapper-floorplan"
                  #floorplanImage
                  [src]="
                    data.projectFolder +
                    f['floorplan_f' + f.floor + '.svg'] +
                    '?_t=' +
                    data._t
                  "
                  [style.transform]="'rotate(' + f.nav_dots_rotation + 'deg)'"
                />
                <div class="vt-map-ponits-wrapper" [ngStyle]="scaleDots(f)">
                  <ng-container
                    *ngFor="let p of data.panoFloorsCoord[i]; index as n"
                  >
                    <div
                      class="vt-map-point"
                      (click)="activePoint === p.index ? false : navTo(p.index)"
                      [class.active]="activePoint === p.index"
                      [ngStyle]="getStyleForDot(f, p)"
                    >
                      <div class="vt-map-point-order">{{ p.order }}</div>
                      <div
                        *ngIf="activePoint === p.index"
                        class="pointer"
                        [style.transform]="'rotate(' + rotationAngle + 'rad)'"
                      ></div>
                    </div>

                    <ng-template #activePointTpl>
                      <div
                        [className]="'vt-map-point active'"
                        [ngStyle]="getStyleForDot(f, p)"
                      >
                        <div class="vt-map-point-order">{{ p.order }}</div>
                        <div
                          class="pointer"
                          [style.transform]="'rotate(' + rotationAngle + 'rad)'"
                        ></div>
                        <!-- (lon + currentDot.rotation_angle) -->
                      </div>
                    </ng-template>
                  </ng-container>
                </div>
              </div>
            </div>
          </ng-template>
        </li>
      </ul>
      <div class="mb-5" [ngbNavOutlet]="nav"></div>
    </div>
  </ng-template>

  <ng-template #mapTplAgm>
    <agm-map
      [latitude]="+data.project.latitude"
      [longitude]="+data.project.longitude"
      [zoom]="17"
    >
      <agm-marker
        [latitude]="+data.project.latitude"
        [longitude]="+data.project.longitude"
      ></agm-marker>
    </agm-map>
  </ng-template>

  <ng-template #mapTpl>
    <ng-container *ngIf="data.additional_data.map; else mapTplAgm">
      <div class="embed-responsive embed-responsive-1by1 map-wrapper">
        <iframe
          class="embed-responsive-item"
          [src]="data.additional_data.map | safe: 'resourceUrl'"
        ></iframe>
      </div>
    </ng-container>
  </ng-template>

  <ng-template #streetViewTplNative>
    <div
      propertyspacesGoogleStreetView
      [coords]="{ lat: +data.project.latitude, lng: +data.project.longitude }"
      id="street-view"
    ></div>
  </ng-template>

  <ng-template #streetViewTpl>
    <ng-container
      *ngIf="data.additional_data.streetView; else streetViewTplNative"
    >
      <div class="embed-responsive embed-responsive-1by1 map-wrapper">
        <iframe
          class="embed-responsive-item"
          [src]="data.additional_data.streetView | safe: 'resourceUrl'"
        ></iframe>
      </div>
    </ng-container>
  </ng-template>

  <ng-template #galleryTpl>
    <div
      *ngIf="gallery$ | async as images"
      class="masonry-grid"
      [style.column-count]="sidebar.clientWidth > 400 ? 3 : 2"
    >
      <div
        *ngFor="let img of images | gallery; index as i"
        class="masonry-grid-item"
        (click)="openImage(i)"
      >
        <figure class="gallery-image m-0">
          <img
            class="img-fluid gallery-img"
            [src]="img.data.src"
            [alt]="img.data.thumb"
          />
          <figcaption>{{ img.data.name }}</figcaption>
        </figure>
      </div>
    </div>

    <!-- <ngx-masonry
      style="min-height: 100px"
      [options]="masonryOptions"
      [ordered]="true"
      *ngIf="gallery$ | async as images"
    >
      <div
        ngxMasonryItem
        *ngFor="let img of images | gallery; index as i"
        (click)="openImage(i)"
        class="masonry-item"
        [prepend]="false"
      >
        <figure class="gallery-image m-0">
          <img
            class="img-fluid gallery-img"
            [src]="img.data.src"
            [alt]="img.data.thumb"
          />
          <figcaption>{{ img.data.name }}</figcaption>
        </figure>
      </div>
    </ngx-masonry> -->
  </ng-template>

  <ng-template #galleryEditorTpl>
    <ng-container *ngIf="gallery$ | async as orderedImages">
      <propertyspaces-gallery-editor
        [isEditable]="isEdit"
        [items]="orderedImages"
        (nameChange)="imageNameChanged($event, data.project_id)"
        (sortChange)="sortChanged($event, data.project_id)"
        (moveToTrash)="deleteGalleryImage($event, data.project_id)"
      ></propertyspaces-gallery-editor>
    </ng-container>
  </ng-template>

  <ng-template #contactTpl>
    Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry
    richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard
    dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon
    tempor, sunt aliqua put a bird on it squid single-origin coffee nulla
    assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore
    wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher
    vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic
    synth nesciunt you probably haven't heard of them accusamus labore
    sustainable VHS.
  </ng-template>

  <ng-template #editTpl>
    <div class="btn-group btn-group-toggle d-flex flex-column edit-menu" ngbRadioGroup name="editingSection" formControlName="activeEditProperty">
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.allPoints"> EDIT ALL NAV POINTS
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.activePoint"> EDIT ACTIVE NAV POINT
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.floorplan"> FLOOR PLAN OPTIONS
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.createGallery"> CREATE PHOTO GALLERY
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.editGallery"> EDIT PHOTO GALLERY
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.editLocation"> EDIT MAP & STREET VIEW
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.editContact"> EDIT CONTACT INFO
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.editPano"> EDIT PANORAMA
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.changeMenu"> CHANGE MENU VIEW
      </label>
      <label ngbButtonLabel class="btn rounded-0 mt-1">
        <input ngbButton type="radio" [value]="editProperties.description"> ADD DESCRIPTION
      </label>
    </div>
  </ng-template>

  <main class="panorama-player d-flex">
    <!-- [rzHandles]="form.value.sidebarSide === 'r' ? 'w' : 'e'" -->
    <div class="boxes d-flex">
      <div
        class="sidebar"
        #sidebar
        [class.stick-right]="form.value.sidebarSide === 'r'"
        mwlResizable
        [style]="styleDeSidbar"
        (resizing)="onResizeEnd($event); resizeCanvas()"
        (resizeEnd)="onResizeEnd($event); updateMasonty()"
      >
        <ngb-accordion
          class="sidebar-accordion"
          #acc="ngbAccordion"
        >
          <ngb-panel [cardClass]="'sidebar-card ' + panelActiveClass(acc.activeIds, 'panel-floorplan')" id="panel-floorplan">
            <ng-template ngbPanelHeader>
              <div
                class="d-flex justify-content-between align-items-center w-100"
              >
                <button ngbPanelToggle class="btn flex-fill text-left p-0">
                  <svg-icon src="assets/img/icons/floorplan.svg" class="sidebar-header-icon-stroke mr-3"></svg-icon>
                  <span class="text-uppercase">Floor Plan</span>
                </button>
                <button
                  class="btn"
                  (click)="
                    openSectionModal(modalWrapper, floorplanTpl, 'Floor Plan')
                  "
                >
                <svg-icon src="assets/img/icons/expand.svg" class="sidebar-header-icon-fill sidebar-header-icon-stroke"></svg-icon>
                </button>
              </div>
            </ng-template>
            <ng-template ngbPanelContent>
              <ng-container *ngTemplateOutlet="floorplanTpl"></ng-container>
            </ng-template>
          </ngb-panel>

          <ngb-panel
          [cardClass]="'sidebar-card ' + panelActiveClass(acc.activeIds, 'panel-map')"
            id="panel-map"
            *ngIf="data.additional_data.mapEnabled"
          >
            <ng-template ngbPanelHeader>
              <div
                class="d-flex justify-content-between align-items-center w-100"
              >
                <button ngbPanelToggle class="btn flex-fill text-left p-0">
                  <svg-icon src="assets/img/icons/map-marker.svg" class="sidebar-header-icon-stroke sidebar-header-icon-fill mr-3"></svg-icon>
                  <span class="text-uppercase">Map</span>
                </button>
                <button
                  class="btn"
                  (click)="
                    openSectionModal(modalWrapper, mapTpl, 'Map')
                  "
                >
                  <svg-icon src="assets/img/icons/expand.svg" class="sidebar-header-icon-fill sidebar-header-icon-stroke"></svg-icon>
                </button>
              </div>
            </ng-template>
            <ng-template ngbPanelContent>
              <ng-container *ngTemplateOutlet="mapTpl"></ng-container>
            </ng-template>
          </ngb-panel>

          <ngb-panel
          [cardClass]="'sidebar-card ' + panelActiveClass(acc.activeIds, 'panel-sv')"
            id="panel-sv"
            *ngIf="data.additional_data.streetViewEnabled"
          >
            <ng-template ngbPanelHeader>
              <div
                class="d-flex justify-content-between align-items-center w-100"
              >
                <button ngbPanelToggle class="btn flex-fill text-left p-0">
                  <svg-icon src="assets/img/icons/map-marker.svg" class="sidebar-header-icon-stroke sidebar-header-icon-fill mr-3"></svg-icon>
                  <span class="text-uppercase">Street view</span>
                </button>              
                <button
                  class="btn"
                  (click)="
                    openSectionModal(modalWrapper, streetViewTpl, 'Street View')
                  "
                >
                  <svg-icon src="assets/img/icons/expand.svg" class="sidebar-header-icon-fill sidebar-header-icon-stroke"></svg-icon>
                </button>
              </div>
            </ng-template>
            <ng-template ngbPanelContent>
              <ng-container *ngTemplateOutlet="streetViewTpl"></ng-container>
            </ng-template>
          </ngb-panel>

          <ngb-panel [cardClass]="'sidebar-card ' + panelActiveClass(acc.activeIds, 'panel-gallery')" 
          id="panel-gallery">
            <ng-template ngbPanelHeader>
              <div
                class="d-flex justify-content-between align-items-center w-100"
              >
                <button ngbPanelToggle class="btn flex-fill text-left p-0">
                  <svg-icon src="assets/img/icons/picture.svg" class="sidebar-header-icon-stroke mr-3"></svg-icon>
                  <span class="text-uppercase">Photo Gallery</span>
                </button>
                <button
                  *ngIf="gallery$ | async as galleryPhotos"
                  class="btn"
                  (click)="
                    openSectionModal(
                      modalWrapper,
                      galleryEditorTpl,
                      'Gallery Editor'
                    )
                  "
                >
                  <svg-icon src="assets/img/icons/expand.svg" class="sidebar-header-icon-fill sidebar-header-icon-stroke"></svg-icon>
                </button>
              </div>
            </ng-template>
            <ng-template ngbPanelContent>
              <ng-container *ngTemplateOutlet="galleryTpl"></ng-container>
            </ng-template>
          </ngb-panel>

          <ngb-panel [cardClass]="'sidebar-card ' + panelActiveClass(acc.activeIds, 'panel-contact')" 
          id="panel-contact">
            <ng-template ngbPanelHeader>
              <div
                class="d-flex justify-content-between align-items-center w-100"
              >
                <button ngbPanelToggle class="btn flex-fill text-left p-0">
                  <svg-icon src="assets/img/icons/contact.svg" class="sidebar-header-icon-stroke mr-3"></svg-icon>
                  <span class="text-uppercase">Contact</span>
                </button>
                <button
                  class="btn"
                  (click)="
                    openSectionModal(modalWrapper, contactTpl, 'Contact')
                  "
                >
                  <svg-icon src="assets/img/icons/expand.svg" class="sidebar-header-icon-fill sidebar-header-icon-stroke"></svg-icon>
                </button>
              </div>
            </ng-template>
            <ng-template ngbPanelContent>
              <ng-container *ngTemplateOutlet="contactTpl"></ng-container>
            </ng-template>
          </ngb-panel>

          <ngb-panel *ngIf="isEdit" [cardClass]="'sidebar-card ' + panelActiveClass(acc.activeIds, 'panel-edit')" 
          id="panel-edit">
            <ng-template ngbPanelHeader>
              <div
                class="d-flex justify-content-between align-items-center w-100"
              >
                <button ngbPanelToggle class="btn flex-fill text-left p-0">
                  <svg-icon src="assets/img/icons/edit.svg" class="sidebar-header-icon-stroke mr-3"></svg-icon>
                  <span class="text-uppercase">Edit</span>
                </button>
                <button
                  class="btn"
                  (click)="
                    openSectionModal(modalWrapper, editTpl, 'Edit')
                  "
                >
                  <svg-icon src="assets/img/icons/cog.svg" class="sidebar-header-icon-stroke sidebar-header-icon-fill"></svg-icon>
                </button>
              </div>
            </ng-template>
            <ng-template ngbPanelContent>
              <ng-container *ngTemplateOutlet="editTpl"></ng-container>
            </ng-template>
          </ngb-panel>

        </ngb-accordion>
        



        <div
          mwlResizeHandle
          [resizeEdges]="{
            right: form.value.sidebarSide !== 'r',
            left: form.value.sidebarSide === 'r'
          }"
          class="resize-handle d-flex align-items-center justify-content-center"
          [class.resize-handle-left]="form.value.sidebarSide !== 'r'"
          [class.resize-handle-right]="form.value.sidebarSide === 'r'"
        >
          <div><img src="assets/img/icons/resize.svg" alt="Resize" /></div>
        </div>
      </div>
      <div class="content">
        <div class="gallery-wrapper" *ngIf="gallery$ | async as galleryItems">
          <div
            class="close-gallery"
            *ngIf="isGalleryOpened"
            (click)="closeGallery()"
          >
            <span class="h1">&times;</span>
          </div>
          <gallery
            id="project-gallery"
            [class.d-none]="!isGalleryOpened"
            [items]="galleryItems | gallery"
            [itemTemplate]="itemTemplate"
            [thumb]="false"
          ></gallery>
          <ng-template
            #itemTemplate
            let-index="index"
            let-type="type"
            let-data="data"
            let-currIndex="currIndex"
          >
          <div *ngIf="type === 'image' && index === currIndex"
          [@slideAnimation]
          class="item-description-block">
            <span class="gallery-item-name mb-2">{{ data?.name }}</span>
            <button class="btn btn-link">
              <span class="mr-1">Download</span> <img src="assets/img/icons/download.svg" alt="Download" />
            </button>
          </div>
            
          </ng-template>
        </div>

        <div
          class="main-scene-wrapper"
          #sceneWrapper
          [style.width]="canvasAspect(sceneWrapper)"
        >

          <button *ngIf="!form.value.activeEditProperty" type="button" class="btn" id="fullscreen">
            <img src="assets/img/icons/expand.svg" alt="Fullscreen">
          </button>

          <button type="button" 
          *ngIf="editProperties.createGallery === form.value.activeEditProperty"
          class="btn btn-danger"
          id="take-tour-screenshot" (click)="takeScreenshot()"><img src="assets/img/icons/camera.svg" alt="Take a screeshot"></button>

          <div class="gallery-bar d-flex flex-column" *ngIf="editProperties.createGallery === form.value.activeEditProperty">
            <div class="gallery-bar-title">Thumbnails</div>
            <div class="gallery-bar-content flex-fill">
              <ng-scrollbar *ngIf="gallery$ | async as galleryItems" class="gallery-bar-scroll" thumbClass="white-scrollbars">
                <div *ngFor="let img of galleryItems | gallery; index as i" class="gallery-bar-image mt-1" (click)="openImage(i)">
                  <figure class="gallery-bar-image__figure m-0">
                    <img
                      class="img-fluid"
                      [src]="img.data.src"
                      [alt]="img.data.thumb"
                    />
                    <div class="gallery-bar-image__shadow">
                      <img class="gallery-bar-image__view" src="assets/img/icons/eye.svg" alt="Eye">
                    </div>
                  </figure>
                </div>
              </ng-scrollbar>
            </div>
            
          </div>

          <div class="gallery-create-zoom" *ngIf="editProperties.createGallery === form.value.activeEditProperty">
            <propertyspaces-slider [customClass]="'white-slider'" [showValue]="false" (input)="zoomChange()" formControlName="zoom" [step]="1" [min]="30" [max]="120">
              <ng-template propertyspacesSliderMinus>
                <img src="assets/img/icons/minus-white.svg" alt="-">
              </ng-template>
              <ng-template propertyspacesSliderPlus>
                <img src="assets/img/icons/plus-white.svg" alt="+">
              </ng-template>
            </propertyspaces-slider>
          </div>


          <div class="card py-3 px-5 edit-nav-points-form" *ngIf="editProperties.allPoints === form.value.activeEditProperty || editProperties.activePoint === form.value.activeEditProperty">
            <form>

              <div class="form-group">
                <label>Nav point rotation</label>

                <propertyspaces-slider *ngIf="editProperties.allPoints === form.value.activeEditProperty" (input)="rotationYChange()" formControlName="rotationY" [step]="0.1" [min]="0" [max]="6.3"></propertyspaces-slider>
                <propertyspaces-slider *ngIf="editProperties.activePoint === form.value.activeEditProperty" (input)="panoCameraStartAngleChange()" formControlName="panoCameraStartAngle" [step]="0.1" [min]="0" [max]="6.3"></propertyspaces-slider>
                

              </div>

              <div class="form-group">
                <label>Zoom</label>
                <propertyspaces-slider *ngIf="editProperties.allPoints === form.value.activeEditProperty" (input)="zoomChange()" formControlName="zoom" [step]="1" [min]="30" [max]="120"></propertyspaces-slider>
                <propertyspaces-slider *ngIf="editProperties.activePoint === form.value.activeEditProperty" (input)="panoZoomChange()" formControlName="panoZoom" [step]="1" [min]="30" [max]="120"></propertyspaces-slider>
              </div>
              
              <div class="text-center">
                <button
                  type="button"
                  (click)="saveSettings(data.project_id)"
                  class="btn btn-dark rounded-pill px-5"
                >
                  Save
                </button>
              </div>
              
            </form>
          </div>

          <canvas
            #virtualTour
            id="virtualTour"
            [propertyspacesVirtualTour]="data"
            (init)="vrInit(data)"
            (navigationChange)="changeActive($event, data.panos)"
            (change)="viewChange($event)"
          ></canvas>
        </div>
      </div>
    </div>
  </main>
</div>
